# Nexus Agent Chrome 扩展 - 功能开发计划

## 设置页面功能状态

### 已完成功能 ✅

#### 1. 基础界面结构
- [x] 设置页面导航（返回按钮）
- [x] 页面标题和布局
- [x] 响应式设计和深色模式支持

#### 2. 连接设置
- [x] 服务器地址输入框（默认值：`http://localhost:3000`）
- [x] 基础的表单样式和布局

#### 3. 工具权限管理系统
- [x] **自动确认功能**：启用后已授权工具自动执行，不弹窗确认
- [x] **工具权限列表**：显示所有危险工具及其风险等级
- [x] **风险等级分类**：
  - 🔴 高风险：`write_file`、`delete_file`、`delete_directory`、`replace_file_content`、`run_command`、`set_env_variable`
  - 🟡 中等风险：`copy_file`、`move_file`、`append_file`、`insert_file_content`
- [x] **权限状态管理**：勾选/取消勾选工具授权状态
- [x] **权限持久化存储**：使用 Chrome Storage API 保存设置
- [x] **重置功能**：一键清除所有设置

#### 4. 数据存储
- [x] Chrome Storage 同步存储
- [x] 权限设置的增删改查
- [x] 自动确认状态的保存和读取

---

### 未完成功能 ❌

#### 1. 连接设置功能
- [x] **服务器地址验证**：支持 URL 格式验证，使用 AgentApi.info() 进行网络连接测试
- [x] **自动连接轮询**：每 5 秒自动检查连接状态，状态变化时实时更新
- [x] **连接状态显示**：实时显示连接状态（已连接/未连接/连接中/错误）和最后检查时间
- [x] **连接配置保存**：服务器地址输入后自动保存到 Chrome Storage
- [x] **连接配置加载**：页面加载时自动从存储中加载已保存的服务器地址

#### 2. 工具分类管理
- [ ] **工具分类功能**：主页面有工具分类数据，但设置页面没有分类管理
- [ ] **分类级别的权限控制**：无法按分类批量管理工具权限
- [ ] **分类的启用/禁用**：无法控制整个分类的开关

#### 3. 高级设置
- [ ] **代理设置**：没有网络代理配置
- [ ] **超时设置**：没有连接超时、请求超时等配置
- [ ] **日志级别设置**：没有调试和日志相关配置
- [ ] **通知设置**：没有通知偏好设置

#### 4. 用户体验优化
- [ ] **设置导入/导出**：无法备份和恢复设置
- [ ] **设置搜索**：没有搜索功能来快速找到特定设置
- [ ] **设置分组**：没有将相关设置分组显示
- [ ] **设置说明**：缺少详细的功能说明和帮助文档

#### 5. 安全相关
- [ ] **密码保护**：没有对敏感设置进行密码保护
- [ ] **权限审计日志**：没有记录权限变更历史
- [ ] **紧急禁用**：没有快速禁用所有危险工具的紧急按钮

#### 6. 集成功能
- [x] **与主页面数据同步**：设置页面的连接配置与主页面实时同步
- [x] **实时更新**：设置变更后主页面实时反映连接状态变化
- [ ] **配置验证**：没有验证配置的完整性和有效性

---

## 开发优先级建议

### 高优先级 🔴
1. **连接设置功能完善** - 核心功能，影响基本使用 ✅
2. **与主页面数据同步** - 用户体验关键 ✅
3. **连接配置保存/加载** - 数据持久化 ✅

### 中优先级 🟡
1. **工具分类管理** - 提升管理效率
2. **实时更新** - 改善用户体验
3. **设置搜索** - 提升易用性

### 低优先级 🟢
1. **高级设置** - 高级用户需求
2. **安全相关功能** - 安全增强
3. **设置导入/导出** - 便利功能

---

## 技术实现要点

### 已实现的技术栈
- React + TypeScript
- Chrome Storage API
- 组件化架构
- 响应式设计

### 需要补充的技术实现
- 网络请求验证 ✅
- 状态管理优化 ✅
- 数据同步机制 ✅
- 错误处理完善 ✅

---

## 文件结构说明

```
packages/chrome-ext/src/
├── components/
│   ├── SettingsPage/
│   │   └── index.tsx          # 设置页面主组件
│   ├── QuickActions/
│   │   └── index.tsx          # 快速操作组件（已移除测试连接按钮）
│   └── ToolPermissionsManager/
│       └── index.tsx          # 工具权限管理组件
├── config/
│   └── permission.ts          # 权限配置和类型定义
├── hooks/
│   └── useConnectionPolling.ts # 连接状态轮询 Hook
├── utils/
│   └── storage.ts             # 存储工具类
└── APPPlan.md                 # 本文档
```

---

*最后更新：2024年12月*
